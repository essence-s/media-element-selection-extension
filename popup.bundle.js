(()=>{"use strict";var t="GET_VIDEOS_DATA";function e(t,e){return new Promise((function(n,r){chrome.tabs.sendMessage(parseInt(t),e,(function(t){chrome.runtime.lastError?r(chrome.runtime.lastError.message):n(t)}))}))}function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function r(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function o(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?r(Object(n),!0).forEach((function(e){a(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function a(t,e,r){return(e=function(t){var e=function(t,e){if("object"!=n(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,"string");if("object"!=n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==n(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function c(t,e){"no-connect"==e?t.classList.add("no-conect"):t.classList.remove("no-conect"),t.innerHTML="\n        <p>\n            Video Seleccionado\n            <img src='".concat(i.favIconUrl,'\' crossorigin="anonymous" class="data-save-img-icon" />\n        </p>\n        <img src=').concat(i.imgCover," class='img-option'> \n    ")}var i={tabId:"",imgNumber:"",imgCover:"",favIconUrl:""},s=localStorage.getItem("dataG");s&&(i=JSON.parse(s),e(parseInt(i.tabId),{cmd:"CHECK_CONNECTION"}).then((function(t){"connected"==t.message&&c(dataSaveVideo)})).catch((function(t){console.log("Error al enviar mensaje:",t),c(dataSaveVideo,"no-connect")}))),setTimeout((function(){chrome.tabs.query({},(function(t){try{dataTabs.innerHTML=t.map((function(t){return'<div class="tab-title" dataID=\''.concat(t.id,"'>\n                    <img src='").concat(t.favIconUrl,'\' crossorigin="anonymous" /> ').concat(t.title,"\n                </div >")})).join("")}catch(t){console.log(t)}}))}),100),dataTabs.addEventListener("click",(function(n){if(n.target.classList.contains("tab-title")){var r=n.target.getAttribute("dataID");window.location.href="#dataVideos",e(parseInt(r),{cmd:t}).then((function(t){console.log("Mensaje enviado:",t)})).catch((function(n){console.log("Error al enviar mensaje:",n),chrome.scripting.executeScript({target:{tabId:parseInt(r),allFrames:!0},files:["content.bundle.js"]}).then((function(){console.log("script injected in all jaus"),e(parseInt(r),{cmd:t}).then((function(t){console.log("Mensaje enviado:",t)})).catch((function(t){console.log("Error al enviar mensaje 2:",t)}))}))}))}})),dataVideos.addEventListener("click",(function(t){if(t.target.classList.contains("img-option")){var n=function(){i.imgNumber=t.target.getAttribute("imgNumber"),i.imgCover=t.target.src,i.tabId=t.target.getAttribute("tabId"),chrome.tabs.get(parseInt(t.target.getAttribute("tabId")),(function(t){var n,r;i.favIconUrl=t.favIconUrl,localStorage.setItem("dataG",JSON.stringify(i)),n={cmd:"updateDataG",data:i},new Promise((function(t,e){chrome.runtime.sendMessage(n,(function(n){chrome.runtime.lastError?e(chrome.runtime.lastError):t(n)}))})),c(dataSaveVideo),e(parseInt(i.tabId),{cmd:"ADD_EVENTS_ELEMENT",data:{idNumber:i.imgNumber}}),r={selected:!1},0!=Object.keys(i).length&&(r={selected:!0}),chrome.tabs.query({url:["https://ahiseve.vercel.app/*","http://localhost:4321/*"]},(function(t){t.forEach((function(t){e(t.id,{cmd:"RESULT_CHECK_ELEMENT_VIDEO_SELECTED",data:r})}))}))}))};""==i.tabId?n():e(parseInt(i.tabId),{cmd:"REMOVE_EVENTS_ELEMENTS",data:{idNumber:i.imgNumber}}).then((function(t){"ok"==t.status&&n()})).catch((function(t){console.log("error remove",t),n()}))}}));var u=[],m=[];chrome.runtime.onMessage.addListener((function(t,e,n){"responseIMGS"==t.cmd?(m.push(t.data.map((function(t){return o(o({},t),{},{tabId:e.tab.id})}))),function(t){dataVideos.innerHTML=t.map((function(t){return"<img class='img-option' tabId='".concat(t.tabId,"' imgNumber=\"").concat(t.number,'" src="').concat(t.img,'" > ')})).join("")}(m.flat())):"ElementVideo"==t.cmd&&u.push(t.data.id)}))})();